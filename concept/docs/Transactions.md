# Типы транзакций ✔

## Двойное подтверждение транзакций

1. Клиент выполняет перевод UTT на ТФ с указанием МК-ИД, тем самым подтверждая, что данный резерв активирован.

2. Контейнер посылает запрос на прохождение ТФ с помощью Proposed  транзакции с двумя подтверждениями на списание РА у ТФ.

3. ТФ делает подтверждение, если может принять  контейнер.

4. Гейт кипер увидев первое подтверждение от ТФ открывает ворота, как только ворота открыты он дает свое подтверждение.

5. Контейнер увидев оба подтверждения (транзакция завершена) начинает движение через ТФ.

6. ТФ создает Proposed транзакцию с двумя подтверждениями на списание РА контейнера.

7. Контейнер проходит ТФ и делает подтверждение транзакции.

8. Увидев первое подтверждение гейт кипер закрывает ворота, и затем дает свое подтверждение.

9. ТФ получив оба подтверждения (транзакция завершена) считает операцию законченной.

10. Клиент увидев окончание операции, создает обычную транзакцию на оплату Контейнеру.

Проблема данного сценария заключается  возможности отозвать подтверждение или поставить вето любым из участников транзакции, что приведет к заморозке ситуации в неопределенном состоянии. Вето можно принять за происхождение нештатной ситуации с оборудованием: поломка станции или вагона делает невозможным дальнейшие операции.

В схеме присутствуют две транзакции и по два подтверждения на каждую и одна обычная.

Первая транзакция:

* Контейнер заинтересован в ней, так как это позволит двигаться по маршрут и он является получателем РА в данной транзакции.

* ТФ заинтересована в выполнении транзакции, так как получит РА в следующей транзакции, только после завершения этой.

* Gate keeper физически может являться частью ТФ, и он заинтересован в транзакции *(см. пред. пункт)*.

Вторая транзакция:

* ТФ заинтересована в ней, так как является получателем РА.

* Gate keeper, как часть ТФ заинтересован в ней.

* Вагон заинтересован в подтверждении транзакции, так как после ее подтверждения получит оплату от Клиента.

## Альтернативные варианты

### Вариант 1: первым переводится РА ТФ

1. Запрос разрешения на прохождение ТФ от Контейнера
Контейнер посылает Proposed Transaction на получение РА ТФ 

2. Подтверждение запроса на прохождения ТФ
Контейнер делает Approve транзакции

3. Факт прохода ТФ Контейнером
ТФ делает Proposed Transaction на получение РА Контейнера

4. Контейнер прошел ТФ
Контейнер делает Approve транзакции

### Вариант 2: первым переводится РА ТФ

1. Запрос разрешения на прохождение ТФ от Контейнера
Контейнер посылает Proposed Transaction на передачу своего РА 

2. Подтверждение запроса на прохождения ТФ
ТФ делает Approve транзакции

3. Факт прохода ТФ Контейнером
ТФ делает Proposed Transaction на передачу своего РА контейнеру

4. Контейнер прошел ТФ
Контейнер делает Approve транзакции
