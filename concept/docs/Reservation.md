# Резервирование РА ✔

С помощью резервирования ОФИ могут заранее договорится между собой об операции. Это необходимо для избежания ситуации, когда настало время взаимодействия, однако для этого взаимодействия нет достаточного количества РА. При этом полностью избежать такие ситуации не возможно, однако резервирование может свести их к минимуму.

Предположим, что у маршрутной карты есть срок годности *(см. [[Работа с маршрутной картой|Route Map]]))*.Тогда зарезервированные РА должны возвращаться по истечение срока годности соответствующей маршрутной карты.

## Способ учета резерва

Актор обладает двойным аккаунтов в сети U-TRANSNET. Для резервирования, переводит с одного аккаунт, на второй. Первый используется для расчета его РА при построении маршрутной карты, второй используется для переводов при движении по маршруту.

* Внешние акторы могут видеть объем незарезервированных РА, для построения маршрутной карты.

* Резервирование отражается в блокчейне.

* У актора имеется пул, на расходы по запланированным маршрутам, что снижает вероятность исчерпания РА в процессе маршрута.

* Использование двух учеток позволит перемещать средства в одном направлении: основной пул -> резерв -> перевод другой стороне. Такой способ позволяет избежать перевода средств из резерва в основной пул и смешивание свободных и зарезервированных РА.

* Двойной аккаунт для ОФИ.

#### Альтернативные варианты

1. Актор ведет учет внутри себя.

* Просто в реализации

* Операция не отражается в блокчейне

* Сторонний наблюдатель не может узнать объем незарезервированного РА 

Актор самостоятельно следит за сроком годности маршрутной карты, по истечению которого, зарезервированные средства должны вернуться в основной пул.

1. Актор создает ордер на продажу резерва, при этом должны быть созданы условия невозможности выкупа данного ордера.

    * Перед использование РА, необходимо отменить ордер, и зарезервированные средства смешиваются с основным пулом.

2. Акторы создают Proposed transaction на некоторый счет, но не подтверждают со своей строны. РА висит недоступным, до момента использования, перед которым актор отменяет эту транзакцию.

    * Перед использование РА, необходимо отменить транзакцию, и зарезервированные средства смешиваются с основным пулом.



## Участники транзакций

1. Вагон:

    * Резервирование РА при получении маршрутной карты.
Отдельная транзакция на каждый будущий перевод на маршруте.

    * Перевод РА точкам фиксации при прохождении их.

    * Получение РА от ТФ при прохождении их.

    * Получение UTT после прохождения ТФ от клиента.

2. ТФ:

    * Получение UTT с помощью propose с указанием МК ИД для создания соответствующего резерва.

    * Резервирование перед исполнением маршрутной карты.

    * Расход собственного РА при прохождении точки контейнером.

    * Получение РА от контейнера, при прохождении точки контейнером.

3. Станция (действует аналогично ТФ + следующие действия):

    * На первой станции (начало движения), при передаче собственного РА вагону, передается маршрутная карта в МЕМО транзакции.

4. Логист:

    * Получение UTT без резервирование от клиента за построение маршрутной карты.

    * Управляющая транзакция клиенту для передачи МК.

5. Клиент:
Клиент не создает собственного резерва, вероятно клиентское ПО должно учитывать объем свободного и зарезервированного UTT.

    * Перевод UTT станции перед началом поездки.

    * Перевод UTT ТФ перед проездом через нее.

    * Перевод UTT без резервирования вагону после проезда ТФ.

## Процесс работы

1. Логист резервирует РА ТФ делая управляющую транзакцию к ТФ содержащую (ИД-МК) и proposed transaction от клиента к ОФИ пути. Запрос выполняется путем отправки UTT proposed transaction.

2. ОФИ резервируют необходимый объем РА исходя из полученного запроса.

3. При получении маршрутной карты вагон резервирует свои РА необходимые на выполнения маршрута.

4. Списывание РА из резерва.

5. В случае отмена маршрута (по получению специального сообщение или таймауту): зеркальные транзакции на внутренних учетках ОФИ.
