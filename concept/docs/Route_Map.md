# Работа с маршрутной картой ✔

*Прим. Процесс построения маршрутной карты происходит вне симулятора, симулятор получит готовую карту во входных данных.*

### Действующие объекты

* Клиент — некая абстракция пользователя транспортной сетью, это может быть как пассажир, так и груз (владелец груза).

* Логист — некий объект (софт сделанный сторонним лицом?) выполняющий услуги составления маршрутной карты.

* Вагон — объект физической инфраструктуры передвигающийся по пути.

* Станция — ОФИ, маршрут должен начинаться и заканчиваться на станции.

* Промежуточные точки — ОФИ,некие точки на линии следования через которые проходит вагон.

* Точка фиксация — абстракция представляющая станцию и промежуточную точку. При прохождении ТФ вагон и ТФ обмениваются ресурсными активами.

* Маршрутная карта — виртуальный объект, содержащий последовательность ТФ и стоимость прохождения через них.

* Стоимость — объем некоего заданного РА, кот. необходимо перевести для прохождения через ТФ.

### Работа с маршрутной картой

1. Клиент заказывает построение маршрутной карты у логиста, процесс заказа и построение остается за рамками данного описания. Результат работы оформляется в виде управляющей транзакции от логиста к клиенту, где в МЕМО содержится маршрутная карта в сериализованном виде.

2. Для создание резерва у ТФ логист выполняет управляющие транзакции к ТФ содержащие идентификатор маршрутной карты.

3. При построении маршрутной карты логист создает proposed transaction от клиента к ТФ.

4. В итоге маршрутная карта сохранена в блокчейне, и клиент может получить к ней доступ. Так как прочитать МЕМО может только клиент и логист, маршрут защищен от посторонних (сохраняется приватность, вряд ли все готовы делится информацией о своем маршруте).

5. Клиент обладает неким ПО, через который делал заказ на построение маршрутной карты, в нем же он может просмотреть построенный маршрут.

6. Для совершения поездки / отправки груза клиент через свое ПО делает заказ у станции. Для этого он совершает управляющую транзакцию к станции, где в МЕМО содержится сериализованная маршрутная карта: ПО переносит содержание МЕМО транзакции от логиста в новую.

7. Станция делает управляющую транзакцию с маршрутной картой в МЕМО вагону, который назначен для выполнения маршрута.

8. Вагон резервирует необходимое количество РА исходя из расчетов в маршрутной карте.

9. В качестве подтверждения, что заказ принят вагон передает свой РА станции.

10. Станция делает proposal на оплату от клиента, подтверждая возможность поездки.

11. Клиент подтверждает оплату, сообщая о готовности сесть в вагон.

12. Станция переводит свой РА вагону, сообщая, что посадка разрешена.

13. Клиент переводит UTT вагону с МК-ИД, сообщая, о том что сел в вагон..

### Кто принимает заказ на перевозку и маршрутную карту?

Клиент обращается с готовой маршрутной картой к станции для заказа. Станция знает все маршрутные карты поданные ей (на данный момент это не используется).

Станция подберет клиенту подходящий вагон, который может исполнить маршрутную карту. [[Процесс заказа (подачи) вагона|Boarding]]


### Что необходимо продумать

1. Как обрабатывать ситуации невозможности исполнения маршрутной карты (до начала исполнения, на этапе резервирования РА)?

    1. Недостаточно РА вагона (см. пункт 1).

    2. Недостаточно РА пути (ТФ).
Как такая ситуация могла произойти: на этапе составления маршрутной карты логист опрашивает ОФИ пути для избежания этого, однако существует временной лаг, между созданием и принятием к исполнению маршрутного плана.
Как избежать:

        1. Срок годности маршрутной карты.

        2. Резервирование РА при составлении маршрутной карты.
Совмещается ли функции логист и станции?

